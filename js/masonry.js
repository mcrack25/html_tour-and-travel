!function(t,i){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size"],i):"object"==typeof module&&module.exports?module.exports=i(require("outlayer"),require("get-size")):t.Masonry=i(t.Outlayer,t.getSize)}(window,function(t,i){"use strict";var o=t.create("masonry");o.compatOptions.fitWidth="isFitWidth";var e=o.prototype;return e._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var t=0;t<this.cols;t++)this.colYs.push(0);this.maxY=0,this.horizontalColIndex=0},e.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var t=this.items[0],o=t&&t.element;this.columnWidth=o&&i(o).outerWidth||this.containerWidth}var e=this.columnWidth+=this.gutter,h=this.containerWidth+this.gutter,n=h/e,s=e-h%e,r=s&&s<1?"round":"floor";n=Math[r](n),this.cols=Math.max(n,1)},e.getContainerWidth=function(){var t=this._getOption("fitWidth"),o=t?this.element.parentNode:this.element,e=i(o);this.containerWidth=e&&e.innerWidth},e._getItemLayoutPosition=function(t){t.getSize();var i=t.size.outerWidth%this.columnWidth,o=i&&i<1?"round":"ceil",e=Math[o](t.size.outerWidth/this.columnWidth);e=Math.min(e,this.cols);for(var h=this.options.horizontalOrder?"_getHorizontalColPosition":"_getTopColPosition",n=this[h](e,t),s={x:this.columnWidth*n.col,y:n.y},r=n.y+t.size.outerHeight,a=e+n.col,u=n.col;u<a;u++)this.colYs[u]=r;return s},e._getTopColPosition=function(t){var i=this._getTopColGroup(t),o=Math.min.apply(Math,i);return{col:i.indexOf(o),y:o}},e._getTopColGroup=function(t){if(t<2)return this.colYs;for(var i=[],o=this.cols+1-t,e=0;e<o;e++)i[e]=this._getColGroupY(e,t);return i},e._getColGroupY=function(t,i){if(i<2)return this.colYs[t];var o=this.colYs.slice(t,t+i);return Math.max.apply(Math,o)},e._getHorizontalColPosition=function(t,i){var o=this.horizontalColIndex%this.cols,e=t>1&&o+t>this.cols;o=e?0:o;var h=i.size.outerWidth&&i.size.outerHeight;return this.horizontalColIndex=h?o+t:this.horizontalColIndex,{col:o,y:this._getColGroupY(o,t)}},e._manageStamp=function(t){var o=i(t),e=this._getElementOffset(t),h=this._getOption("originLeft"),n=h?e.left:e.right,s=n+o.outerWidth,r=Math.floor(n/this.columnWidth);r=Math.max(0,r);var a=Math.floor(s/this.columnWidth);a-=s%this.columnWidth?0:1,a=Math.min(this.cols-1,a);for(var u=this._getOption("originTop"),l=(u?e.top:e.bottom)+o.outerHeight,c=r;c<=a;c++)this.colYs[c]=Math.max(l,this.colYs[c])},e._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var t={height:this.maxY};return this._getOption("fitWidth")&&(t.width=this._getContainerFitWidth()),t},e._getContainerFitWidth=function(){for(var t=0,i=this.cols;--i&&0===this.colYs[i];)t++;return(this.cols-t)*this.columnWidth-this.gutter},e.needsResizeLayout=function(){var t=this.containerWidth;return this.getContainerWidth(),t!=this.containerWidth},o});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hc29ucnkuanMiXSwibmFtZXMiOlsid2luZG93IiwiZmFjdG9yeSIsImRlZmluZSIsImFtZCIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZXF1aXJlIiwiTWFzb25yeSIsIk91dGxheWVyIiwiZ2V0U2l6ZSIsImNyZWF0ZSIsImNvbXBhdE9wdGlvbnMiLCJmaXRXaWR0aCIsInByb3RvIiwicHJvdG90eXBlIiwiX3Jlc2V0TGF5b3V0IiwidGhpcyIsIl9nZXRNZWFzdXJlbWVudCIsIm1lYXN1cmVDb2x1bW5zIiwiY29sWXMiLCJpIiwiY29scyIsInB1c2giLCJtYXhZIiwiaG9yaXpvbnRhbENvbEluZGV4IiwiZ2V0Q29udGFpbmVyV2lkdGgiLCJjb2x1bW5XaWR0aCIsImZpcnN0SXRlbSIsIml0ZW1zIiwiZmlyc3RJdGVtRWxlbSIsImVsZW1lbnQiLCJvdXRlcldpZHRoIiwiY29udGFpbmVyV2lkdGgiLCJndXR0ZXIiLCJleGNlc3MiLCJtYXRoTWV0aG9kIiwiTWF0aCIsIm1heCIsImlzRml0V2lkdGgiLCJfZ2V0T3B0aW9uIiwiY29udGFpbmVyIiwicGFyZW50Tm9kZSIsInNpemUiLCJpbm5lcldpZHRoIiwiX2dldEl0ZW1MYXlvdXRQb3NpdGlvbiIsIml0ZW0iLCJyZW1haW5kZXIiLCJjb2xTcGFuIiwibWluIiwiY29sUG9zTWV0aG9kIiwib3B0aW9ucyIsImhvcml6b250YWxPcmRlciIsImNvbFBvc2l0aW9uIiwicG9zaXRpb24iLCJ4IiwiY29sIiwieSIsInNldEhlaWdodCIsIm91dGVySGVpZ2h0Iiwic2V0TWF4IiwiX2dldFRvcENvbFBvc2l0aW9uIiwiY29sR3JvdXAiLCJfZ2V0VG9wQ29sR3JvdXAiLCJtaW5pbXVtWSIsImFwcGx5IiwiaW5kZXhPZiIsImdyb3VwQ291bnQiLCJfZ2V0Q29sR3JvdXBZIiwiZ3JvdXBDb2xZcyIsInNsaWNlIiwiX2dldEhvcml6b250YWxDb2xQb3NpdGlvbiIsImlzT3ZlciIsImhhc1NpemUiLCJfbWFuYWdlU3RhbXAiLCJzdGFtcCIsInN0YW1wU2l6ZSIsIm9mZnNldCIsIl9nZXRFbGVtZW50T2Zmc2V0IiwiaXNPcmlnaW5MZWZ0IiwiZmlyc3RYIiwibGVmdCIsInJpZ2h0IiwibGFzdFgiLCJmaXJzdENvbCIsImZsb29yIiwibGFzdENvbCIsImlzT3JpZ2luVG9wIiwic3RhbXBNYXhZIiwidG9wIiwiYm90dG9tIiwiX2dldENvbnRhaW5lclNpemUiLCJoZWlnaHQiLCJ3aWR0aCIsIl9nZXRDb250YWluZXJGaXRXaWR0aCIsInVudXNlZENvbHMiLCJuZWVkc1Jlc2l6ZUxheW91dCIsInByZXZpb3VzV2lkdGgiXSwibWFwcGluZ3MiOiJDQVFFLFNBQVVBLEVBQVFDLEdBR0ksa0JBQVZDLFNBQXdCQSxPQUFPQyxJQUV6Q0QsUUFDSSxvQkFDQSxxQkFFRkQsR0FDeUIsZ0JBQVZHLFNBQXNCQSxPQUFPQyxRQUU5Q0QsT0FBT0MsUUFBVUosRUFDZkssUUFBUSxZQUNSQSxRQUFRLGFBSVZOLEVBQU9PLFFBQVVOLEVBQ2ZELEVBQU9RLFNBQ1BSLEVBQU9TLFVBSVZULE9BQVEsU0FBa0JRLEVBQVVDLEdBRXZDLFlBS0UsSUFBSUYsR0FBVUMsRUFBU0UsT0FBTyxVQUU5QkgsR0FBUUksY0FBY0MsU0FBVyxZQUVqQyxJQUFJQyxHQUFRTixFQUFRTyxTQWlNcEIsT0EvTEFELEdBQU1FLGFBQWUsV0FDbkJDLEtBQUtQLFVBQ0xPLEtBQUtDLGdCQUFpQixjQUFlLGNBQ3JDRCxLQUFLQyxnQkFBaUIsU0FBVSxjQUNoQ0QsS0FBS0UsaUJBR0xGLEtBQUtHLFFBQ0wsS0FBTSxHQUFJQyxHQUFFLEVBQUdBLEVBQUlKLEtBQUtLLEtBQU1ELElBQzVCSixLQUFLRyxNQUFNRyxLQUFNLEVBR25CTixNQUFLTyxLQUFPLEVBQ1pQLEtBQUtRLG1CQUFxQixHQUc1QlgsRUFBTUssZUFBaUIsV0FHckIsR0FGQUYsS0FBS1MscUJBRUNULEtBQUtVLFlBQWMsQ0FDdkIsR0FBSUMsR0FBWVgsS0FBS1ksTUFBTSxHQUN2QkMsRUFBZ0JGLEdBQWFBLEVBQVVH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YXNvbnJ5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBNYXNvbnJ5IHY0LjIuMlxuICogQ2FzY2FkaW5nIGdyaWQgbGF5b3V0IGxpYnJhcnlcbiAqIGh0dHBzOi8vbWFzb25yeS5kZXNhbmRyby5jb21cbiAqIE1JVCBMaWNlbnNlXG4gKiBieSBEYXZpZCBEZVNhbmRyb1xuICovXG5cbiggZnVuY3Rpb24oIHdpbmRvdywgZmFjdG9yeSApIHtcbiAgLy8gdW5pdmVyc2FsIG1vZHVsZSBkZWZpbml0aW9uXG4gIC8qIGpzaGludCBzdHJpY3Q6IGZhbHNlICovIC8qZ2xvYmFscyBkZWZpbmUsIG1vZHVsZSwgcmVxdWlyZSAqL1xuICBpZiAoIHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kICkge1xuICAgIC8vIEFNRFxuICAgIGRlZmluZSggW1xuICAgICAgICAnb3V0bGF5ZXIvb3V0bGF5ZXInLFxuICAgICAgICAnZ2V0LXNpemUvZ2V0LXNpemUnXG4gICAgICBdLFxuICAgICAgZmFjdG9yeSApO1xuICB9IGVsc2UgaWYgKCB0eXBlb2YgbW9kdWxlID09ICdvYmplY3QnICYmIG1vZHVsZS5leHBvcnRzICkge1xuICAgIC8vIENvbW1vbkpTXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KFxuICAgICAgcmVxdWlyZSgnb3V0bGF5ZXInKSxcbiAgICAgIHJlcXVpcmUoJ2dldC1zaXplJylcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIC8vIGJyb3dzZXIgZ2xvYmFsXG4gICAgd2luZG93Lk1hc29ucnkgPSBmYWN0b3J5KFxuICAgICAgd2luZG93Lk91dGxheWVyLFxuICAgICAgd2luZG93LmdldFNpemVcbiAgICApO1xuICB9XG5cbn0oIHdpbmRvdywgZnVuY3Rpb24gZmFjdG9yeSggT3V0bGF5ZXIsIGdldFNpemUgKSB7XG5cbid1c2Ugc3RyaWN0JztcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gbWFzb25yeURlZmluaXRpb24gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuICAvLyBjcmVhdGUgYW4gT3V0bGF5ZXIgbGF5b3V0IGNsYXNzXG4gIHZhciBNYXNvbnJ5ID0gT3V0bGF5ZXIuY3JlYXRlKCdtYXNvbnJ5Jyk7XG4gIC8vIGlzRml0V2lkdGggLT4gZml0V2lkdGhcbiAgTWFzb25yeS5jb21wYXRPcHRpb25zLmZpdFdpZHRoID0gJ2lzRml0V2lkdGgnO1xuXG4gIHZhciBwcm90byA9IE1hc29ucnkucHJvdG90eXBlO1xuXG4gIHByb3RvLl9yZXNldExheW91dCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2V0U2l6ZSgpO1xuICAgIHRoaXMuX2dldE1lYXN1cmVtZW50KCAnY29sdW1uV2lkdGgnLCAnb3V0ZXJXaWR0aCcgKTtcbiAgICB0aGlzLl9nZXRNZWFzdXJlbWVudCggJ2d1dHRlcicsICdvdXRlcldpZHRoJyApO1xuICAgIHRoaXMubWVhc3VyZUNvbHVtbnMoKTtcblxuICAgIC8vIHJlc2V0IGNvbHVtbiBZXG4gICAgdGhpcy5jb2xZcyA9IFtdO1xuICAgIGZvciAoIHZhciBpPTA7IGkgPCB0aGlzLmNvbHM7IGkrKyApIHtcbiAgICAgIHRoaXMuY29sWXMucHVzaCggMCApO1xuICAgIH1cblxuICAgIHRoaXMubWF4WSA9IDA7XG4gICAgdGhpcy5ob3Jpem9udGFsQ29sSW5kZXggPSAwO1xuICB9O1xuXG4gIHByb3RvLm1lYXN1cmVDb2x1bW5zID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5nZXRDb250YWluZXJXaWR0aCgpO1xuICAgIC8vIGlmIGNvbHVtbldpZHRoIGlzIDAsIGRlZmF1bHQgdG8gb3V0ZXJXaWR0aCBvZiBmaXJzdCBpdGVtXG4gICAgaWYgKCAhdGhpcy5jb2x1bW5XaWR0aCApIHtcbiAgICAgIHZhciBmaXJzdEl0ZW0gPSB0aGlzLml0ZW1zWzBdO1xuICAgICAgdmFyIGZpcnN0SXRlbUVsZW0gPSBmaXJzdEl0ZW0gJiYgZmlyc3RJdGVtLmVsZW1lbnQ7XG4gICAgICAvLyBjb2x1bW5XaWR0aCBmYWxsIGJhY2sgdG8gaXRlbSBvZiBmaXJzdCBlbGVtZW50XG4gICAgICB0aGlzLmNvbHVtbldpZHRoID0gZmlyc3RJdGVtRWxlbSAmJiBnZXRTaXplKCBmaXJzdEl0ZW1FbGVtICkub3V0ZXJXaWR0aCB8fFxuICAgICAgICAvLyBpZiBmaXJzdCBlbGVtIGhhcyBubyB3aWR0aCwgZGVmYXVsdCB0byBzaXplIG9mIGNvbnRhaW5lclxuICAgICAgICB0aGlzLmNvbnRhaW5lcldpZHRoO1xuICAgIH1cblxuICAgIHZhciBjb2x1bW5XaWR0aCA9IHRoaXMuY29sdW1uV2lkdGggKz0gdGhpcy5ndXR0ZXI7XG5cbiAgICAvLyBjYWxjdWxhdGUgY29sdW1uc1xuICAgIHZhciBjb250YWluZXJXaWR0aCA9IHRoaXMuY29udGFpbmVyV2lkdGggKyB0aGlzLmd1dHRlcjtcbiAgICB2YXIgY29scyA9IGNvbnRhaW5lcldpZHRoIC8gY29sdW1uV2lkdGg7XG4gICAgLy8gZml4IHJvdW5kaW5nIGVycm9ycywgdHlwaWNhbGx5IHdpdGggZ3V0dGVyc1xuICAgIHZhciBleGNlc3MgPSBjb2x1bW5XaWR0aCAtIGNvbnRhaW5lcldpZHRoICUgY29sdW1uV2lkdGg7XG4gICAgLy8gaWYgb3ZlcnNob290IGlzIGxlc3MgdGhhbiBhIHBpeGVsLCByb3VuZCB1cCwgb3RoZXJ3aXNlIGZsb29yIGl0XG4gICAgdmFyIG1hdGhNZXRob2QgPSBleGNlc3MgJiYgZXhjZXNzIDwgMSA/ICdyb3VuZCcgOiAnZmxvb3InO1xuICAgIGNvbHMgPSBNYXRoWyBtYXRoTWV0aG9kIF0oIGNvbHMgKTtcbiAgICB0aGlzLmNvbHMgPSBNYXRoLm1heCggY29scywgMSApO1xuICB9O1xuXG4gIHByb3RvLmdldENvbnRhaW5lcldpZHRoID0gZnVuY3Rpb24oKSB7XG4gICAgLy8gY29udGFpbmVyIGlzIHBhcmVudCBpZiBmaXQgd2lkdGhcbiAgICB2YXIgaXNGaXRXaWR0aCA9IHRoaXMuX2dldE9wdGlvbignZml0V2lkdGgnKTtcbiAgICB2YXIgY29udGFpbmVyID0gaXNGaXRXaWR0aCA/IHRoaXMuZWxlbWVudC5wYXJlbnROb2RlIDogdGhpcy5lbGVtZW50O1xuICAgIC8vIGNoZWNrIHRoYXQgdGhpcy5zaXplIGFuZCBzaXplIGFyZSB0aGVyZVxuICAgIC8vIElFOCB0cmlnZ2VycyByZXNpemUgb24gYm9keSBzaXplIGNoYW5nZSwgc28gdGhleSBtaWdodCBub3QgYmVcbiAgICB2YXIgc2l6ZSA9IGdldFNpemUoIGNvbnRhaW5lciApO1xuICAgIHRoaXMuY29udGFpbmVyV2lkdGggPSBzaXplICYmIHNpemUuaW5uZXJXaWR0aDtcbiAgfTtcblxuICBwcm90by5fZ2V0SXRlbUxheW91dFBvc2l0aW9uID0gZnVuY3Rpb24oIGl0ZW0gKSB7XG4gICAgaXRlbS5nZXRTaXplKCk7XG4gICAgLy8gaG93IG1hbnkgY29sdW1ucyBkb2VzIHRoaXMgYnJpY2sgc3BhblxuICAgIHZhciByZW1haW5kZXIgPSBpdGVtLnNpemUub3V0ZXJXaWR0aCAlIHRoaXMuY29sdW1uV2lkdGg7XG4gICAgdmFyIG1hdGhNZXRob2QgPSByZW1haW5kZXIgJiYgcmVtYWluZGVyIDwgMSA/ICdyb3VuZCcgOiAnY2VpbCc7XG4gICAgLy8gcm91bmQgaWYgb2ZmIGJ5IDEgcGl4ZWwsIG90aGVyd2lzZSB1c2UgY2VpbFxuICAgIHZhciBjb2xTcGFuID0gTWF0aFsgbWF0aE1ldGhvZCBdKCBpdGVtLnNpemUub3V0ZXJXaWR0aCAvIHRoaXMuY29sdW1uV2lkdGggKTtcbiAgICBjb2xTcGFuID0gTWF0aC5taW4oIGNvbFNwYW4sIHRoaXMuY29scyApO1xuICAgIC8vIHVzZSBob3Jpem9udGFsIG9yIHRvcCBjb2x1bW4gcG9zaXRpb25cbiAgICB2YXIgY29sUG9zTWV0aG9kID0gdGhpcy5vcHRpb25zLmhvcml6b250YWxPcmRlciA/XG4gICAgICAnX2dldEhvcml6b250YWxDb2xQb3NpdGlvbicgOiAnX2dldFRvcENvbFBvc2l0aW9uJztcbiAgICB2YXIgY29sUG9zaXRpb24gPSB0aGlzWyBjb2xQb3NNZXRob2QgXSggY29sU3BhbiwgaXRlbSApO1xuICAgIC8vIHBvc2l0aW9uIHRoZSBicmlja1xuICAgIHZhciBwb3NpdGlvbiA9IHtcbiAgICAgIHg6IHRoaXMuY29sdW1uV2lkdGggKiBjb2xQb3NpdGlvbi5jb2wsXG4gICAgICB5OiBjb2xQb3NpdGlvbi55XG4gICAgfTtcbiAgICAvLyBhcHBseSBzZXRIZWlnaHQgdG8gbmVjZXNzYXJ5IGNvbHVtbnNcbiAgICB2YXIgc2V0SGVpZ2h0ID0gY29sUG9zaXRpb24ueSArIGl0ZW0uc2l6ZS5vdXRlckhlaWdodDtcbiAgICB2YXIgc2V0TWF4ID0gY29sU3BhbiArIGNvbFBvc2l0aW9uLmNvbDtcbiAgICBmb3IgKCB2YXIgaSA9IGNvbFBvc2l0aW9uLmNvbDsgaSA8IHNldE1heDsgaSsrICkge1xuICAgICAgdGhpcy5jb2xZc1tpXSA9IHNldEhlaWdodDtcbiAgICB9XG5cbiAgICByZXR1cm4gcG9zaXRpb247XG4gIH07XG5cbiAgcHJvdG8uX2dldFRvcENvbFBvc2l0aW9uID0gZnVuY3Rpb24oIGNvbFNwYW4gKSB7XG4gICAgdmFyIGNvbEdyb3VwID0gdGhpcy5fZ2V0VG9wQ29sR3JvdXAoIGNvbFNwYW4gKTtcbiAgICAvLyBnZXQgdGhlIG1pbmltdW0gWSB2YWx1ZSBmcm9tIHRoZSBjb2x1bW5zXG4gICAgdmFyIG1pbmltdW1ZID0gTWF0aC5taW4uYXBwbHkoIE1hdGgsIGNvbEdyb3VwICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY29sOiBjb2xHcm91cC5pbmRleE9mKCBtaW5pbXVtWSApLFxuICAgICAgeTogbWluaW11bVksXG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbFNwYW4gLSBudW1iZXIgb2YgY29sdW1ucyB0aGUgZWxlbWVudCBzcGFuc1xuICAgKiBAcmV0dXJucyB7QXJyYXl9IGNvbEdyb3VwXG4gICAqL1xuICBwcm90by5fZ2V0VG9wQ29sR3JvdXAgPSBmdW5jdGlvbiggY29sU3BhbiApIHtcbiAgICBpZiAoIGNvbFNwYW4gPCAyICkge1xuICAgICAgLy8gaWYgYnJpY2sgc3BhbnMgb25seSBvbmUgY29sdW1uLCB1c2UgYWxsIHRoZSBjb2x1bW4gWXNcbiAgICAgIHJldHVybiB0aGlzLmNvbFlzO1xuICAgIH1cblxuICAgIHZhciBjb2xHcm91cCA9IFtdO1xuICAgIC8vIGhvdyBtYW55IGRpZmZlcmVudCBwbGFjZXMgY291bGQgdGhpcyBicmljayBmaXQgaG9yaXpvbnRhbGx5XG4gICAgdmFyIGdyb3VwQ291bnQgPSB0aGlzLmNvbHMgKyAxIC0gY29sU3BhbjtcbiAgICAvLyBmb3IgZWFjaCBncm91cCBwb3RlbnRpYWwgaG9yaXpvbnRhbCBwb3NpdGlvblxuICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGdyb3VwQ291bnQ7IGkrKyApIHtcbiAgICAgIGNvbEdyb3VwW2ldID0gdGhpcy5fZ2V0Q29sR3JvdXBZKCBpLCBjb2xTcGFuICk7XG4gICAgfVxuICAgIHJldHVybiBjb2xHcm91cDtcbiAgfTtcblxuICBwcm90by5fZ2V0Q29sR3JvdXBZID0gZnVuY3Rpb24oIGNvbCwgY29sU3BhbiApIHtcbiAgICBpZiAoIGNvbFNwYW4gPCAyICkge1xuICAgICAgcmV0dXJuIHRoaXMuY29sWXNbIGNvbCBdO1xuICAgIH1cbiAgICAvLyBtYWtlIGFuIGFycmF5IG9mIGNvbFkgdmFsdWVzIGZvciB0aGF0IG9uZSBncm91cFxuICAgIHZhciBncm91cENvbFlzID0gdGhpcy5jb2xZcy5zbGljZSggY29sLCBjb2wgKyBjb2xTcGFuICk7XG4gICAgLy8gYW5kIGdldCB0aGUgbWF4IHZhbHVlIG9mIHRoZSBhcnJheVxuICAgIHJldHVybiBNYXRoLm1heC5hcHBseSggTWF0aCwgZ3JvdXBDb2xZcyApO1xuICB9O1xuXG4gIC8vIGdldCBjb2x1bW4gcG9zaXRpb24gYmFzZWQgb24gaG9yaXpvbnRhbCBpbmRleC4gIzg3M1xuICBwcm90by5fZ2V0SG9yaXpvbnRhbENvbFBvc2l0aW9uID0gZnVuY3Rpb24oIGNvbFNwYW4sIGl0ZW0gKSB7XG4gICAgdmFyIGNvbCA9IHRoaXMuaG9yaXpvbnRhbENvbEluZGV4ICUgdGhpcy5jb2xzO1xuICAgIHZhciBpc092ZXIgPSBjb2xTcGFuID4gMSAmJiBjb2wgKyBjb2xTcGFuID4gdGhpcy5jb2xzO1xuICAgIC8vIHNoaWZ0IHRvIG5leHQgcm93IGlmIGl0ZW0gY2FuJ3QgZml0IG9uIGN1cnJlbnQgcm93XG4gICAgY29sID0gaXNPdmVyID8gMCA6IGNvbDtcbiAgICAvLyBkb24ndCBsZXQgemVyby1zaXplIGl0ZW1zIHRha2UgdXAgc3BhY2VcbiAgICB2YXIgaGFzU2l6ZSA9IGl0ZW0uc2l6ZS5vdXRlcldpZHRoICYmIGl0ZW0uc2l6ZS5vdXRlckhlaWdodDtcbiAgICB0aGlzLmhvcml6b250YWxDb2xJbmRleCA9IGhhc1NpemUgPyBjb2wgKyBjb2xTcGFuIDogdGhpcy5ob3Jpem9udGFsQ29sSW5kZXg7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY29sOiBjb2wsXG4gICAgICB5OiB0aGlzLl9nZXRDb2xHcm91cFkoIGNvbCwgY29sU3BhbiApLFxuICAgIH07XG4gIH07XG5cbiAgcHJvdG8uX21hbmFnZVN0YW1wID0gZnVuY3Rpb24oIHN0YW1wICkge1xuICAgIHZhciBzdGFtcFNpemUgPSBnZXRTaXplKCBzdGFtcCApO1xuICAgIHZhciBvZmZzZXQgPSB0aGlzLl9nZXRFbGVtZW50T2Zmc2V0KCBzdGFtcCApO1xuICAgIC8vIGdldCB0aGUgY29sdW1ucyB0aGF0IHRoaXMgc3RhbXAgYWZmZWN0c1xuICAgIHZhciBpc09yaWdpbkxlZnQgPSB0aGlzLl9nZXRPcHRpb24oJ29yaWdpbkxlZnQnKTtcbiAgICB2YXIgZmlyc3RYID0gaXNPcmlnaW5MZWZ0ID8gb2Zmc2V0LmxlZnQgOiBvZmZzZXQucmlnaHQ7XG4gICAgdmFyIGxhc3RYID0gZmlyc3RYICsgc3RhbXBTaXplLm91dGVyV2lkdGg7XG4gICAgdmFyIGZpcnN0Q29sID0gTWF0aC5mbG9vciggZmlyc3RYIC8gdGhpcy5jb2x1bW5XaWR0aCApO1xuICAgIGZpcnN0Q29sID0gTWF0aC5tYXgoIDAsIGZpcnN0Q29sICk7XG4gICAgdmFyIGxhc3RDb2wgPSBNYXRoLmZsb29yKCBsYXN0WCAvIHRoaXMuY29sdW1uV2lkdGggKTtcbiAgICAvLyBsYXN0Q29sIHNob3VsZCBub3QgZ28gb3ZlciBpZiBtdWx0aXBsZSBvZiBjb2x1bW5XaWR0aCAjNDI1XG4gICAgbGFzdENvbCAtPSBsYXN0WCAlIHRoaXMuY29sdW1uV2lkdGggPyAwIDogMTtcbiAgICBsYXN0Q29sID0gTWF0aC5taW4oIHRoaXMuY29scyAtIDEsIGxhc3RDb2wgKTtcbiAgICAvLyBzZXQgY29sWXMgdG8gYm90dG9tIG9mIHRoZSBzdGFtcFxuXG4gICAgdmFyIGlzT3JpZ2luVG9wID0gdGhpcy5fZ2V0T3B0aW9uKCdvcmlnaW5Ub3AnKTtcbiAgICB2YXIgc3RhbXBNYXhZID0gKCBpc09yaWdpblRvcCA/IG9mZnNldC50b3AgOiBvZmZzZXQuYm90dG9tICkgK1xuICAgICAgc3RhbXBTaXplLm91dGVySGVpZ2h0O1xuICAgIGZvciAoIHZhciBpID0gZmlyc3RDb2w7IGkgPD0gbGFzdENvbDsgaSsrICkge1xuICAgICAgdGhpcy5jb2xZc1tpXSA9IE1hdGgubWF4KCBzdGFtcE1heFksIHRoaXMuY29sWXNbaV0gKTtcbiAgICB9XG4gIH07XG5cbiAgcHJvdG8uX2dldENvbnRhaW5lclNpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1heFkgPSBNYXRoLm1heC5hcHBseSggTWF0aCwgdGhpcy5jb2xZcyApO1xuICAgIHZhciBzaXplID0ge1xuICAgICAgaGVpZ2h0OiB0aGlzLm1heFlcbiAgICB9O1xuXG4gICAgaWYgKCB0aGlzLl9nZXRPcHRpb24oJ2ZpdFdpZHRoJykgKSB7XG4gICAgICBzaXplLndpZHRoID0gdGhpcy5fZ2V0Q29udGFpbmVyRml0V2lkdGgoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2l6ZTtcbiAgfTtcblxuICBwcm90by5fZ2V0Q29udGFpbmVyRml0V2lkdGggPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgdW51c2VkQ29scyA9IDA7XG4gICAgLy8gY291bnQgdW51c2VkIGNvbHVtbnNcbiAgICB2YXIgaSA9IHRoaXMuY29scztcbiAgICB3aGlsZSAoIC0taSApIHtcbiAgICAgIGlmICggdGhpcy5jb2xZc1tpXSAhPT0gMCApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICB1bnVzZWRDb2xzKys7XG4gICAgfVxuICAgIC8vIGZpdCBjb250YWluZXIgdG8gY29sdW1ucyB0aGF0IGhhdmUgYmVlbiB1c2VkXG4gICAgcmV0dXJuICggdGhpcy5jb2xzIC0gdW51c2VkQ29scyApICogdGhpcy5jb2x1bW5XaWR0aCAtIHRoaXMuZ3V0dGVyO1xuICB9O1xuXG4gIHByb3RvLm5lZWRzUmVzaXplTGF5b3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHByZXZpb3VzV2lkdGggPSB0aGlzLmNvbnRhaW5lcldpZHRoO1xuICAgIHRoaXMuZ2V0Q29udGFpbmVyV2lkdGgoKTtcbiAgICByZXR1cm4gcHJldmlvdXNXaWR0aCAhPSB0aGlzLmNvbnRhaW5lcldpZHRoO1xuICB9O1xuXG4gIHJldHVybiBNYXNvbnJ5O1xuXG59KSk7XG4iXX0=
