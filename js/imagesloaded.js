!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter")):t.imagesLoaded=e(t,t.EvEmitter)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function i(t,e){for(var i in e)t[i]=e[i];return t}function o(t){if(Array.isArray(t))return t;var e="object"==typeof t&&"number"==typeof t.length;return e?d.call(t):[t]}function r(t,e,n){if(!(this instanceof r))return new r(t,e,n);var s=t;return"string"==typeof t&&(s=document.querySelectorAll(t)),s?(this.elements=o(s),this.options=i({},this.options),"function"==typeof e?n=e:i(this.options,e),n&&this.on("always",n),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(s||t))}function n(t){this.img=t}function s(t,e){this.url=t,this.element=e,this.img=new Image}var h=t.jQuery,a=t.console,d=Array.prototype.slice;r.prototype=Object.create(e.prototype),r.prototype.options={},r.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},r.prototype.addElementImages=function(t){"IMG"==t.nodeName&&this.addImage(t),this.options.background===!0&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&m[e]){for(var i=t.querySelectorAll("img"),o=0;o<i.length;o++){var r=i[o];this.addImage(r)}if("string"==typeof this.options.background){var n=t.querySelectorAll(this.options.background);for(o=0;o<n.length;o++){var s=n[o];this.addElementBackgroundImages(s)}}}};var m={1:!0,9:!0,11:!0};return r.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var i=/url\((['"])?(.*?)\1\)/gi,o=i.exec(e.backgroundImage);null!==o;){var r=o&&o[2];r&&this.addBackground(r,t),o=i.exec(e.backgroundImage)}},r.prototype.addImage=function(t){var e=new n(t);this.images.push(e)},r.prototype.addBackground=function(t,e){var i=new s(t,e);this.images.push(i)},r.prototype.check=function(){function t(t,i,o){setTimeout(function(){e.progress(t,i,o)})}var e=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(e){e.once("progress",t),e.check()}):void this.complete()},r.prototype.progress=function(t,e,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,t,e)},r.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},n.prototype=Object.create(e.prototype),n.prototype.check=function(){var t=this.getIsImageComplete();return t?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},n.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},n.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.img,e])},n.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},n.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},n.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},n.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(n.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var t=this.getIsImageComplete();t&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},r.makeJQueryPlugin=function(e){e=e||t.jQuery,e&&(h=e,h.fn.imagesLoaded=function(t,e){var i=new r(this,t,e);return i.jqDeferred.promise(h(this))})},r.makeJQueryPlugin(),r});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImltYWdlc2xvYWRlZC5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiRXZFbWl0dGVyIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlcXVpcmUiLCJpbWFnZXNMb2FkZWQiLCJ0aGlzIiwiZXh0ZW5kIiwiYSIsImIiLCJwcm9wIiwibWFrZUFycmF5Iiwib2JqIiwiQXJyYXkiLCJpc0FycmF5IiwiaXNBcnJheUxpa2UiLCJsZW5ndGgiLCJhcnJheVNsaWNlIiwiY2FsbCIsIkltYWdlc0xvYWRlZCIsImVsZW0iLCJvcHRpb25zIiwib25BbHdheXMiLCJxdWVyeUVsZW0iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlbGVtZW50cyIsIm9uIiwiZ2V0SW1hZ2VzIiwiJCIsImpxRGVmZXJyZWQiLCJEZWZlcnJlZCIsInNldFRpbWVvdXQiLCJjaGVjayIsImJpbmQiLCJjb25zb2xlIiwiZXJyb3IiLCJMb2FkaW5nSW1hZ2UiLCJpbWciLCJCYWNrZ3JvdW5kIiwidXJsIiwiZWxlbWVudCIsIkltYWdlIiwialF1ZXJ5IiwicHJvdG90eXBlIiwic2xpY2UiLCJPYmplY3QiLCJjcmVhdGUiLCJpbWFnZXMiLCJmb3JFYWNoIiwiYWRkRWxlbWVudEltYWdlcyIsIm5vZGVOYW1lIiwiYWRkSW1hZ2UiLCJiYWNrZ3JvdW5kIiwiYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMiLCJub2RlVHlwZSIsImVsZW1lbnROb2RlVHlwZXMiLCJjaGlsZEltZ3MiLCJpIiwiY2hpbGRyZW4iLCJjaGlsZCIsIjEiLCI5IiwiMTEiLCJzdHlsZSIsImdldENvbXB1dGVkU3R5bGUiLCJyZVVSTCIsIm1hdGNoZXMiLCJleGVjIiwiYmFja2dyb3VuZEltYWdlIiwiYWRkQmFja2dyb3VuZCIsImxvYWRpbmdJbWFnZSIsInB1c2giLCJvblByb2dyZXNzIiwiaW1hZ2UiLCJtZXNzYWdlIiwiX3RoaXMiLCJwcm9ncmVzcyIsInByb2dyZXNzZWRDb3VudCIsImhhc0FueUJyb2tlbiIsIm9uY2UiLCJjb21wbGV0ZSIsImlzTG9hZGVkIiwiZW1pdEV2ZW50Iiwibm90aWZ5IiwiZGVidWciLCJsb2ciLCJldmVudE5hbWUiLCJpc0NvbXBsZXRlIiwianFNZXRob2QiLCJnZXRJc0ltYWdlQ29tcGxldGUiLCJjb25maXJtIiwibmF0dXJhbFdpZHRoIiwicHJveHlJbWFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzcmMiLCJoYW5kbGVFdmVudCIsImV2ZW50IiwibWV0aG9kIiwidHlwZSIsIm9ubG9hZCIsInVuYmluZEV2ZW50cyIsIm9uZXJyb3IiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwibWFrZUpRdWVyeVBsdWdpbiIsImZuIiwiY2FsbGJhY2siLCJpbnN0YW5jZSIsInByb21pc2UiXSwibWFwcGluZ3MiOiJDQU1BLFNBQVlBLEVBQVFDLEdBQVksWUFLUixtQkFBVkMsU0FBd0JBLE9BQU9DLElBRXpDRCxRQUNFLHlCQUNDLFNBQVVFLEdBQ1gsTUFBT0gsR0FBU0QsRUFBUUksS0FFQyxnQkFBVkMsU0FBc0JBLE9BQU9DLFFBRTlDRCxPQUFPQyxRQUFVTCxFQUNmRCxFQUNBTyxRQUFRLGVBSVZQLEVBQU9RLGFBQWVQLEVBQ3BCRCxFQUNBQSxFQUFPSSxZQUlTLG1CQUFYSixRQUF5QkEsT0FBU1MsS0FJN0MsU0FBa0JULEVBQVFJLEdBRTFCLFlBUUEsU0FBU00sR0FBUUMsRUFBR0MsR0FDbEIsSUFBTSxHQUFJQyxLQUFRRCxHQUNoQkQsRUFBR0UsR0FBU0QsRUFBR0MsRUFFakIsT0FBT0YsR0FNVCxRQUFTRyxHQUFXQyxHQUNsQixHQUFLQyxNQUFNQyxRQUFTRixHQUVsQixNQUFPQSxFQUdULElBQUlHLEdBQTRCLGdCQUFQSCxJQUF3QyxnQkFBZEEsR0FBSUksTUFDdkQsT0FBS0QsR0FFSUUsRUFBV0MsS0FBTU4sSUFJakJBLEdBVVgsUUFBU08sR0FBY0MsRUFBTUMsRUFBU0MsR0FFcEMsS0FBUWhCLGVBQWdCYSxJQUN0QixNQUFPLElBQUlBLEdBQWNDLEVBQU1DLEVB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S0FBS2tDLEdBRXBCLElBQUlnRCxHQUFhbEYsS0FBS29GLG9CQUNqQkYsS0FDSGxGLEtBQUtxRixRQUFtQyxJQUExQnJGLEtBQUtnQyxJQUFJc0QsYUFBb0IsZ0JBQzNDdEYsS0FBSytGLGlCQUlUOUQsRUFBV0ssVUFBVXlELGFBQWUsV0FDbEMvRixLQUFLZ0MsSUFBSWlFLG9CQUFxQixPQUFRakcsTUFDdENBLEtBQUtnQyxJQUFJaUUsb0JBQXFCLFFBQVNqRyxPQUd6Q2lDLEVBQVdLLFVBQVUrQyxRQUFVLFNBQVVULEVBQVVQLEdBQ2pEckUsS0FBSzRFLFNBQVdBLEVBQ2hCNUUsS0FBSzZFLFVBQVcsWUFBYzdFLEtBQU1BLEtBQUttQyxRQUFTa0MsS0FLcER4RCxFQUFhcUYsaUJBQW1CLFNBQVU3RCxHQUN4Q0EsRUFBU0EsR0FBVTlDLEVBQU84QyxPQUNwQkEsSUFJTmQsRUFBSWMsRUFFSmQsRUFBRTRFLEdBQUdwRyxhQUFlLFNBQVVnQixFQUFTcUYsR0FDckMsR0FBSUMsR0FBVyxHQUFJeEYsR0FBY2IsS0FBTWUsRUFBU3FGLEVBQ2hELE9BQU9DLEdBQVM3RSxXQUFXOEUsUUFBUy9FLEVBQUV2QixVQUkxQ2EsRUFBYXFGLG1CQUlOckYiLCJmaWxlIjoiaW1hZ2VzbG9hZGVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBpbWFnZXNMb2FkZWQgdjQuMS40XG4gKiBKYXZhU2NyaXB0IGlzIGFsbCBsaWtlIFwiWW91IGltYWdlcyBhcmUgZG9uZSB5ZXQgb3Igd2hhdD9cIlxuICogTUlUIExpY2Vuc2VcbiAqL1xuXG4oIGZ1bmN0aW9uKCB3aW5kb3csIGZhY3RvcnkgKSB7ICd1c2Ugc3RyaWN0JztcbiAgLy8gdW5pdmVyc2FsIG1vZHVsZSBkZWZpbml0aW9uXG5cbiAgLypnbG9iYWwgZGVmaW5lOiBmYWxzZSwgbW9kdWxlOiBmYWxzZSwgcmVxdWlyZTogZmFsc2UgKi9cblxuICBpZiAoIHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kICkge1xuICAgIC8vIEFNRFxuICAgIGRlZmluZSggW1xuICAgICAgJ2V2LWVtaXR0ZXIvZXYtZW1pdHRlcidcbiAgICBdLCBmdW5jdGlvbiggRXZFbWl0dGVyICkge1xuICAgICAgcmV0dXJuIGZhY3RvcnkoIHdpbmRvdywgRXZFbWl0dGVyICk7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoIHR5cGVvZiBtb2R1bGUgPT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHMgKSB7XG4gICAgLy8gQ29tbW9uSlNcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoXG4gICAgICB3aW5kb3csXG4gICAgICByZXF1aXJlKCdldi1lbWl0dGVyJylcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIC8vIGJyb3dzZXIgZ2xvYmFsXG4gICAgd2luZG93LmltYWdlc0xvYWRlZCA9IGZhY3RvcnkoXG4gICAgICB3aW5kb3csXG4gICAgICB3aW5kb3cuRXZFbWl0dGVyXG4gICAgKTtcbiAgfVxuXG59KSggdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB0aGlzLFxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAgZmFjdG9yeSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuXG5mdW5jdGlvbiBmYWN0b3J5KCB3aW5kb3csIEV2RW1pdHRlciApIHtcblxuJ3VzZSBzdHJpY3QnO1xuXG52YXIgJCA9IHdpbmRvdy5qUXVlcnk7XG52YXIgY29uc29sZSA9IHdpbmRvdy5jb25zb2xlO1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBoZWxwZXJzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbi8vIGV4dGVuZCBvYmplY3RzXG5mdW5jdGlvbiBleHRlbmQoIGEsIGIgKSB7XG4gIGZvciAoIHZhciBwcm9wIGluIGIgKSB7XG4gICAgYVsgcHJvcCBdID0gYlsgcHJvcCBdO1xuICB9XG4gIHJldHVybiBhO1xufVxuXG52YXIgYXJyYXlTbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcblxuLy8gdHVybiBlbGVtZW50IG9yIG5vZGVMaXN0IGludG8gYW4gYXJyYXlcbmZ1bmN0aW9uIG1ha2VBcnJheSggb2JqICkge1xuICBpZiAoIEFycmF5LmlzQXJyYXkoIG9iaiApICkge1xuICAgIC8vIHVzZSBvYmplY3QgaWYgYWxyZWFkeSBhbiBhcnJheVxuICAgIHJldHVybiBvYmo7XG4gIH1cblxuICB2YXIgaXNBcnJheUxpa2UgPSB0eXBlb2Ygb2JqID09ICdvYmplY3QnICYmIHR5cGVvZiBvYmoubGVuZ3RoID09ICdudW1iZXInO1xuICBpZiAoIGlzQXJyYXlMaWtlICkge1xuICAgIC8vIGNvbnZlcnQgbm9kZUxpc3QgdG8gYXJyYXlcbiAgICByZXR1cm4gYXJyYXlTbGljZS5jYWxsKCBvYmogKTtcbiAgfVxuXG4gIC8vIGFycmF5IG9mIHNpbmdsZSBpbmRleFxuICByZXR1cm4gWyBvYmogXTtcbn1cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gaW1hZ2VzTG9hZGVkIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbi8qKlxuICogQHBhcmFtIHtBcnJheSwgRWxlbWVudCwgTm9kZUxpc3QsIFN0cmluZ30gZWxlbVxuICogQHBhcmFtIHtPYmplY3Qgb3IgRnVuY3Rpb259IG9wdGlvbnMgLSBpZiBmdW5jdGlvbiwgdXNlIGFzIGNhbGxiYWNrXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkFsd2F5cyAtIGNhbGxiYWNrIGZ1bmN0aW9uXG4gKi9cbmZ1bmN0aW9uIEltYWdlc0xvYWRlZCggZWxlbSwgb3B0aW9ucywgb25BbHdheXMgKSB7XG4gIC8vIGNvZXJjZSBJbWFnZXNMb2FkZWQoKSB3aXRob3V0IG5ldywgdG8gYmUgbmV3IEltYWdlc0xvYWRlZCgpXG4gIGlmICggISggdGhpcyBpbnN0YW5jZW9mIEltYWdlc0xvYWRlZCApICkge1xuICAgIHJldHVybiBuZXcgSW1hZ2VzTG9hZGVkKCBlbGVtLCBvcHRpb25zLCBvbkFsd2F5cyApO1xuICB9XG4gIC8vIHVzZSBlbGVtIGFzIHNlbGVjdG9yIHN0cmluZ1xuICB2YXIgcXVlcnlFbGVtID0gZWxlbTtcbiAgaWYgKCB0eXBlb2YgZWxlbSA9PSAnc3RyaW5nJyApIHtcbiAgICBxdWVyeUVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCBlbGVtICk7XG4gIH1cbiAgLy8gYmFpbCBpZiBiYWQgZWxlbWVudFxuICBpZiAoICFxdWVyeUVsZW0gKSB7XG4gICAgY29uc29sZS5lcnJvciggJ0JhZCBlbGVtZW50IGZvciBpbWFnZXNMb2FkZWQgJyArICggcXVlcnlFbGVtIHx8IGVsZW0gKSApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuZWxlbWVudHMgPSBtYWtlQXJyYXkoIHF1ZXJ5RWxlbSApO1xuICB0aGlzLm9wdGlvbnMgPSBleHRlbmQoIHt9LCB0aGlzLm9wdGlvbnMgKTtcbiAgLy8gc2hpZnQgYXJndW1lbnRzIGlmIG5vIG9wdGlvbnMgc2V0XG4gIGlmICggdHlwZW9mIG9wdGlvbnMgPT0gJ2Z1bmN0aW9uJyApIHtcbiAgICBvbkFsd2F5cyA9IG9wdGlvbnM7XG4gIH0gZWxzZSB7XG4gICAgZXh0ZW5kKCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMgKTtcbiAgfVxuXG4gIGlmICggb25BbHdheXMgKSB7XG4gICAgdGhpcy5vbiggJ2Fsd2F5cycsIG9uQWx3YXlzICk7XG4gIH1cblxuICB0aGlzLmdldEltYWdlcygpO1xuXG4gIGlmICggJCApIHtcbiAgICAvLyBhZGQgalF1ZXJ5IERlZmVycmVkIG9iamVjdFxuICAgIHRoaXMuanFEZWZlcnJlZCA9IG5ldyAkLkRlZmVycmVkKCk7XG4gIH1cblxuICAvLyBIQUNLIGNoZWNrIGFzeW5jIHRvIGFsbG93IHRpbWUgdG8gYmluZCBsaXN0ZW5lcnNcbiAgc2V0VGltZW91dCggdGhpcy5jaGVjay5iaW5kKCB0aGlzICkgKTtcbn1cblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEV2RW1pdHRlci5wcm90b3R5cGUgKTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5vcHRpb25zID0ge307XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuZ2V0SW1hZ2VzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuaW1hZ2VzID0gW107XG5cbiAgLy8gZmlsdGVyICYgZmluZCBpdGVtcyBpZiB3ZSBoYXZlIGFuIGl0ZW0gc2VsZWN0b3JcbiAgdGhpcy5lbGVtZW50cy5mb3JFYWNoKCB0aGlzLmFkZEVsZW1lbnRJbWFnZXMsIHRoaXMgKTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtOb2RlfSBlbGVtZW50XG4gKi9cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkRWxlbWVudEltYWdlcyA9IGZ1bmN0aW9uKCBlbGVtICkge1xuICAvLyBmaWx0ZXIgc2libGluZ3NcbiAgaWYgKCBlbGVtLm5vZGVOYW1lID09ICdJTUcnICkge1xuICAgIHRoaXMuYWRkSW1hZ2UoIGVsZW0gKTtcbiAgfVxuICAvLyBnZXQgYmFja2dyb3VuZCBpbWFnZSBvbiBlbGVtZW50XG4gIGlmICggdGhpcy5vcHRpb25zLmJhY2tncm91bmQgPT09IHRydWUgKSB7XG4gICAgdGhpcy5hZGRFbGVtZW50QmFja2dyb3VuZEltYWdlcyggZWxlbSApO1xuICB9XG5cbiAgLy8gZmluZCBjaGlsZHJlblxuICAvLyBubyBub24tZWxlbWVudCBub2RlcywgIzE0M1xuICB2YXIgbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlO1xuICBpZiAoICFub2RlVHlwZSB8fCAhZWxlbWVudE5vZGVUeXBlc1sgbm9kZVR5cGUgXSApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGNoaWxkSW1ncyA9IGVsZW0ucXVlcnlTZWxlY3RvckFsbCgnaW1nJyk7XG4gIC8vIGNvbmNhdCBjaGlsZEVsZW1zIHRvIGZpbHRlckZvdW5kIGFycmF5XG4gIGZvciAoIHZhciBpPTA7IGkgPCBjaGlsZEltZ3MubGVuZ3RoOyBpKysgKSB7XG4gICAgdmFyIGltZyA9IGNoaWxkSW1nc1tpXTtcbiAgICB0aGlzLmFkZEltYWdlKCBpbWcgKTtcbiAgfVxuXG4gIC8vIGdldCBjaGlsZCBiYWNrZ3JvdW5kIGltYWdlc1xuICBpZiAoIHR5cGVvZiB0aGlzLm9wdGlvbnMuYmFja2dyb3VuZCA9PSAnc3RyaW5nJyApIHtcbiAgICB2YXIgY2hpbGRyZW4gPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoIHRoaXMub3B0aW9ucy5iYWNrZ3JvdW5kICk7XG4gICAgZm9yICggaT0wOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKysgKSB7XG4gICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTtcbiAgICAgIHRoaXMuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMoIGNoaWxkICk7XG4gICAgfVxuICB9XG59O1xuXG52YXIgZWxlbWVudE5vZGVUeXBlcyA9IHtcbiAgMTogdHJ1ZSxcbiAgOTogdHJ1ZSxcbiAgMTE6IHRydWVcbn07XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMgPSBmdW5jdGlvbiggZWxlbSApIHtcbiAgdmFyIHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSApO1xuICBpZiAoICFzdHlsZSApIHtcbiAgICAvLyBGaXJlZm94IHJldHVybnMgbnVsbCBpZiBpbiBhIGhpZGRlbiBpZnJhbWUgaHR0cHM6Ly9idWd6aWwubGEvNTQ4Mzk3XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIGdldCB1cmwgaW5zaWRlIHVybChcIi4uLlwiKVxuICB2YXIgcmVVUkwgPSAvdXJsXFwoKFsnXCJdKT8oLio/KVxcMVxcKS9naTtcbiAgdmFyIG1hdGNoZXMgPSByZVVSTC5leGVjKCBzdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgKTtcbiAgd2hpbGUgKCBtYXRjaGVzICE9PSBudWxsICkge1xuICAgIHZhciB1cmwgPSBtYXRjaGVzICYmIG1hdGNoZXNbMl07XG4gICAgaWYgKCB1cmwgKSB7XG4gICAgICB0aGlzLmFkZEJhY2tncm91bmQoIHVybCwgZWxlbSApO1xuICAgIH1cbiAgICBtYXRjaGVzID0gcmVVUkwuZXhlYyggc3R5bGUuYmFja2dyb3VuZEltYWdlICk7XG4gIH1cbn07XG5cbi8qKlxuICogQHBhcmFtIHtJbWFnZX0gaW1nXG4gKi9cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkSW1hZ2UgPSBmdW5jdGlvbiggaW1nICkge1xuICB2YXIgbG9hZGluZ0ltYWdlID0gbmV3IExvYWRpbmdJbWFnZSggaW1nICk7XG4gIHRoaXMuaW1hZ2VzLnB1c2goIGxvYWRpbmdJbWFnZSApO1xufTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5hZGRCYWNrZ3JvdW5kID0gZnVuY3Rpb24oIHVybCwgZWxlbSApIHtcbiAgdmFyIGJhY2tncm91bmQgPSBuZXcgQmFja2dyb3VuZCggdXJsLCBlbGVtICk7XG4gIHRoaXMuaW1hZ2VzLnB1c2goIGJhY2tncm91bmQgKTtcbn07XG5cbkltYWdlc0xvYWRlZC5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbigpIHtcbiAgdmFyIF90aGlzID0gdGhpcztcbiAgdGhpcy5wcm9ncmVzc2VkQ291bnQgPSAwO1xuICB0aGlzLmhhc0FueUJyb2tlbiA9IGZhbHNlO1xuICAvLyBjb21wbGV0ZSBpZiBubyBpbWFnZXNcbiAgaWYgKCAhdGhpcy5pbWFnZXMubGVuZ3RoICkge1xuICAgIHRoaXMuY29tcGxldGUoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBmdW5jdGlvbiBvblByb2dyZXNzKCBpbWFnZSwgZWxlbSwgbWVzc2FnZSApIHtcbiAgICAvLyBIQUNLIC0gQ2hyb21lIHRyaWdnZXJzIGV2ZW50IGJlZm9yZSBvYmplY3QgcHJvcGVydGllcyBoYXZlIGNoYW5nZWQuICM4M1xuICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuICAgICAgX3RoaXMucHJvZ3Jlc3MoIGltYWdlLCBlbGVtLCBtZXNzYWdlICk7XG4gICAgfSk7XG4gIH1cblxuICB0aGlzLmltYWdlcy5mb3JFYWNoKCBmdW5jdGlvbiggbG9hZGluZ0ltYWdlICkge1xuICAgIGxvYWRpbmdJbWFnZS5vbmNlKCAncHJvZ3Jlc3MnLCBvblByb2dyZXNzICk7XG4gICAgbG9hZGluZ0ltYWdlLmNoZWNrKCk7XG4gIH0pO1xufTtcblxuSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5wcm9ncmVzcyA9IGZ1bmN0aW9uKCBpbWFnZSwgZWxlbSwgbWVzc2FnZSApIHtcbiAgdGhpcy5wcm9ncmVzc2VkQ291bnQrKztcbiAgdGhpcy5oYXNBbnlCcm9rZW4gPSB0aGlzLmhhc0FueUJyb2tlbiB8fCAhaW1hZ2UuaXNMb2FkZWQ7XG4gIC8vIHByb2dyZXNzIGV2ZW50XG4gIHRoaXMuZW1pdEV2ZW50KCAncHJvZ3Jlc3MnLCBbIHRoaXMsIGltYWdlLCBlbGVtIF0gKTtcbiAgaWYgKCB0aGlzLmpxRGVmZXJyZWQgJiYgdGhpcy5qcURlZmVycmVkLm5vdGlmeSApIHtcbiAgICB0aGlzLmpxRGVmZXJyZWQubm90aWZ5KCB0aGlzLCBpbWFnZSApO1xuICB9XG4gIC8vIGNoZWNrIGlmIGNvbXBsZXRlZFxuICBpZiAoIHRoaXMucHJvZ3Jlc3NlZENvdW50ID09IHRoaXMuaW1hZ2VzLmxlbmd0aCApIHtcbiAgICB0aGlzLmNvbXBsZXRlKCk7XG4gIH1cblxuICBpZiAoIHRoaXMub3B0aW9ucy5kZWJ1ZyAmJiBjb25zb2xlICkge1xuICAgIGNvbnNvbGUubG9nKCAncHJvZ3Jlc3M6ICcgKyBtZXNzYWdlLCBpbWFnZSwgZWxlbSApO1xuICB9XG59O1xuXG5JbWFnZXNMb2FkZWQucHJvdG90eXBlLmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gIHZhciBldmVudE5hbWUgPSB0aGlzLmhhc0FueUJyb2tlbiA/ICdmYWlsJyA6ICdkb25lJztcbiAgdGhpcy5pc0NvbXBsZXRlID0gdHJ1ZTtcbiAgdGhpcy5lbWl0RXZlbnQoIGV2ZW50TmFtZSwgWyB0aGlzIF0gKTtcbiAgdGhpcy5lbWl0RXZlbnQoICdhbHdheXMnLCBbIHRoaXMgXSApO1xuICBpZiAoIHRoaXMuanFEZWZlcnJlZCApIHtcbiAgICB2YXIganFNZXRob2QgPSB0aGlzLmhhc0FueUJyb2tlbiA/ICdyZWplY3QnIDogJ3Jlc29sdmUnO1xuICAgIHRoaXMuanFEZWZlcnJlZFsganFNZXRob2QgXSggdGhpcyApO1xuICB9XG59O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuZnVuY3Rpb24gTG9hZGluZ0ltYWdlKCBpbWcgKSB7XG4gIHRoaXMuaW1nID0gaW1nO1xufVxuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRXZFbWl0dGVyLnByb3RvdHlwZSApO1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vIElmIGNvbXBsZXRlIGlzIHRydWUgYW5kIGJyb3dzZXIgc3VwcG9ydHMgbmF0dXJhbCBzaXplcyxcbiAgLy8gdHJ5IHRvIGNoZWNrIGZvciBpbWFnZSBzdGF0dXMgbWFudWFsbHkuXG4gIHZhciBpc0NvbXBsZXRlID0gdGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtcbiAgaWYgKCBpc0NvbXBsZXRlICkge1xuICAgIC8vIHJlcG9ydCBiYXNlZCBvbiBuYXR1cmFsV2lkdGhcbiAgICB0aGlzLmNvbmZpcm0oIHRoaXMuaW1nLm5hdHVyYWxXaWR0aCAhPT0gMCwgJ25hdHVyYWxXaWR0aCcgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBJZiBub25lIG9mIHRoZSBjaGVja3MgYWJvdmUgbWF0Y2hlZCwgc2ltdWxhdGUgbG9hZGluZyBvbiBkZXRhY2hlZCBlbGVtZW50LlxuICB0aGlzLnByb3h5SW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgdGhpcy5wcm94eUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLnByb3h5SW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xuICAvLyBiaW5kIHRvIGltYWdlIGFzIHdlbGwgZm9yIEZpcmVmb3guICMxOTFcbiAgdGhpcy5pbWcuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XG4gIHRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoICdlcnJvcicsIHRoaXMgKTtcbiAgdGhpcy5wcm94eUltYWdlLnNyYyA9IHRoaXMuaW1nLnNyYztcbn07XG5cbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUuZ2V0SXNJbWFnZUNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gIC8vIGNoZWNrIGZvciBub24temVybywgbm9uLXVuZGVmaW5lZCBuYXR1cmFsV2lkdGhcbiAgLy8gZml4ZXMgU2FmYXJpK0luZmluaXRlU2Nyb2xsK01hc29ucnkgYnVnIGluZmluaXRlLXNjcm9sbCM2NzFcbiAgcmV0dXJuIHRoaXMuaW1nLmNvbXBsZXRlICYmIHRoaXMuaW1nLm5hdHVyYWxXaWR0aDtcbn07XG5cbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKCBpc0xvYWRlZCwgbWVzc2FnZSApIHtcbiAgdGhpcy5pc0xvYWRlZCA9IGlzTG9hZGVkO1xuICB0aGlzLmVtaXRFdmVudCggJ3Byb2dyZXNzJywgWyB0aGlzLCB0aGlzLmltZywgbWVzc2FnZSBdICk7XG59O1xuXG4vLyAtLS0tLSBldmVudHMgLS0tLS0gLy9cblxuLy8gdHJpZ2dlciBzcGVjaWZpZWQgaGFuZGxlciBmb3IgZXZlbnQgdHlwZVxuTG9hZGluZ0ltYWdlLnByb3RvdHlwZS5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uKCBldmVudCApIHtcbiAgdmFyIG1ldGhvZCA9ICdvbicgKyBldmVudC50eXBlO1xuICBpZiAoIHRoaXNbIG1ldGhvZCBdICkge1xuICAgIHRoaXNbIG1ldGhvZCBdKCBldmVudCApO1xuICB9XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmNvbmZpcm0oIHRydWUsICdvbmxvYWQnICk7XG4gIHRoaXMudW5iaW5kRXZlbnRzKCk7XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jb25maXJtKCBmYWxzZSwgJ29uZXJyb3InICk7XG4gIHRoaXMudW5iaW5kRXZlbnRzKCk7XG59O1xuXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLnVuYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnByb3h5SW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XG4gIHRoaXMucHJveHlJbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG4gIHRoaXMuaW1nLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLmltZy5yZW1vdmVFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG59O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBCYWNrZ3JvdW5kIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbmZ1bmN0aW9uIEJhY2tncm91bmQoIHVybCwgZWxlbWVudCApIHtcbiAgdGhpcy51cmwgPSB1cmw7XG4gIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gIHRoaXMuaW1nID0gbmV3IEltYWdlKCk7XG59XG5cbi8vIGluaGVyaXQgTG9hZGluZ0ltYWdlIHByb3RvdHlwZVxuQmFja2dyb3VuZC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBMb2FkaW5nSW1hZ2UucHJvdG90eXBlICk7XG5cbkJhY2tncm91bmQucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xuICB0aGlzLmltZy5hZGRFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XG4gIHRoaXMuaW1nLnNyYyA9IHRoaXMudXJsO1xuICAvLyBjaGVjayBpZiBpbWFnZSBpcyBhbHJlYWR5IGNvbXBsZXRlXG4gIHZhciBpc0NvbXBsZXRlID0gdGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtcbiAgaWYgKCBpc0NvbXBsZXRlICkge1xuICAgIHRoaXMuY29uZmlybSggdGhpcy5pbWcubmF0dXJhbFdpZHRoICE9PSAwLCAnbmF0dXJhbFdpZHRoJyApO1xuICAgIHRoaXMudW5iaW5kRXZlbnRzKCk7XG4gIH1cbn07XG5cbkJhY2tncm91bmQucHJvdG90eXBlLnVuYmluZEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmltZy5yZW1vdmVFdmVudExpc3RlbmVyKCAnbG9hZCcsIHRoaXMgKTtcbiAgdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xufTtcblxuQmFja2dyb3VuZC5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKCBpc0xvYWRlZCwgbWVzc2FnZSApIHtcbiAgdGhpcy5pc0xvYWRlZCA9IGlzTG9hZGVkO1xuICB0aGlzLmVtaXRFdmVudCggJ3Byb2dyZXNzJywgWyB0aGlzLCB0aGlzLmVsZW1lbnQsIG1lc3NhZ2UgXSApO1xufTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0galF1ZXJ5IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbkltYWdlc0xvYWRlZC5tYWtlSlF1ZXJ5UGx1Z2luID0gZnVuY3Rpb24oIGpRdWVyeSApIHtcbiAgalF1ZXJ5ID0galF1ZXJ5IHx8IHdpbmRvdy5qUXVlcnk7XG4gIGlmICggIWpRdWVyeSApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gc2V0IGxvY2FsIHZhcmlhYmxlXG4gICQgPSBqUXVlcnk7XG4gIC8vICQoKS5pbWFnZXNMb2FkZWQoKVxuICAkLmZuLmltYWdlc0xvYWRlZCA9IGZ1bmN0aW9uKCBvcHRpb25zLCBjYWxsYmFjayApIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgSW1hZ2VzTG9hZGVkKCB0aGlzLCBvcHRpb25zLCBjYWxsYmFjayApO1xuICAgIHJldHVybiBpbnN0YW5jZS5qcURlZmVycmVkLnByb21pc2UoICQodGhpcykgKTtcbiAgfTtcbn07XG4vLyB0cnkgbWFraW5nIHBsdWdpblxuSW1hZ2VzTG9hZGVkLm1ha2VKUXVlcnlQbHVnaW4oKTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbnJldHVybiBJbWFnZXNMb2FkZWQ7XG5cbn0pO1xuIl19
